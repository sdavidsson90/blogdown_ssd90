---
title: Introducing the bike crash data
author: Sighvatur Davidsson
date: '2022-01-24'
slug: []
categories: []
tags:
  - datavisualisation
  - eda
  - gis
  - mapping
---

<script src="{{< blogdown/postref >}}index.en_files/header-attrs/header-attrs.js"></script>


<p>In this first post I want to introduce the bike-crash dataset I used in my final thesis. There were two primary reasons for choosing this dataset.</p>
<ol style="list-style-type: decimal">
<li><p>Not all data is equally suitable for machine learning tasks. For complex learning tasks a large number of observations is required (at least &gt; 1,000). This dataset has 12,000.</p></li>
<li><p>Secondly the dataset should not only contain categorical variables but also some continous. This makes for easier modelling.</p></li>
<li><p>Although there exists a huge interest in</p></li>
</ol>
<p>Paradoxically there has never existed more data in the world than to dat</p>
<pre class="r"><code># Workspace setup 
pacman::p_load(tidyverse,     # essentials
               ggeasy,        # ggplot-function wrapper for easing workflow
               cowplot,       # for aligning plots
               sf,            # allows for working with spatial data
               tmap,          # mapping package 
               hrbrthemes)    # cool plotting theme

# Set standard theme
theme_set(theme_ipsum_ps())</code></pre>
<pre class="r"><code># Read in data
bike_crash &lt;- read_rds(&quot;~/R/Projects/bike_crash/processed_data/bike_crash.rds&quot;)</code></pre>
<pre class="r"><code># Crashes over time
plot_grid(
  bike_crash %&gt;% count(crash_year) %&gt;% 
    ggplot(aes(x = crash_year, y = n)) + 
    geom_bar(stat = &quot;identity&quot;) + 
    ylab(&quot;&quot;) +
    theme(axis.text.x=element_text(angle=90, hjust=1)),
  bike_crash %&gt;% 
    count(crash_month) %&gt;% 
    ggplot(aes(x = crash_month, y = n)) + 
    geom_bar(stat = &quot;identity&quot;) + 
    ylab(&quot;&quot;) +
    theme(axis.text.x=element_text(angle=90, hjust=1)),
  bike_crash %&gt;% 
    count(crash_hour) %&gt;% 
    ggplot(aes(x = crash_hour, y = n)) + 
    geom_bar(stat = &quot;identity&quot;) + 
    ylab(&quot;&quot;) +
    theme(axis.text.x=element_text(angle=90, hjust=1)),
  bike_crash %&gt;% 
    count(crash_day) %&gt;% 
    ggplot(aes(x = crash_day, y = n)) + 
    geom_bar(stat = &quot;identity&quot;) + 
    ylab(&quot;&quot;) +
    theme(axis.text.x=element_text(angle=90, hjust=1)))</code></pre>
<pre><code>## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family
## &#39;IBMPlexSans&#39; not found in PostScript font database

## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family
## &#39;IBMPlexSans&#39; not found in PostScript font database

## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family
## &#39;IBMPlexSans&#39; not found in PostScript font database

## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family
## &#39;IBMPlexSans&#39; not found in PostScript font database

## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family
## &#39;IBMPlexSans&#39; not found in PostScript font database

## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family
## &#39;IBMPlexSans&#39; not found in PostScript font database

## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family
## &#39;IBMPlexSans&#39; not found in PostScript font database

## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family
## &#39;IBMPlexSans&#39; not found in PostScript font database

## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family
## &#39;IBMPlexSans&#39; not found in PostScript font database

## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family
## &#39;IBMPlexSans&#39; not found in PostScript font database

## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family
## &#39;IBMPlexSans&#39; not found in PostScript font database

## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family
## &#39;IBMPlexSans&#39; not found in PostScript font database

## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family
## &#39;IBMPlexSans&#39; not found in PostScript font database

## Warning in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)): font family
## &#39;IBMPlexSans&#39; not found in PostScript font database</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code># Crash_severity
bind_rows(
  bike_crash %&gt;% 
    group_by(crash_year, ambulance_r)  %&gt;% 
    count(crash_sevr, ambulance_r) %&gt;% 
    na.omit() %&gt;% 
    summarise(n = sum(n)) %&gt;%
    transmute(crash_year, crash_sevr = &quot;Total&quot;, ambulance_r, n) %&gt;% 
    ungroup(),
  bike_crash %&gt;% 
    group_by(crash_year, ambulance_r) %&gt;% 
    count(crash_sevr, ambulance_r) %&gt;%  
    na.omit() %&gt;% 
    ungroup()
  ) %&gt;% mutate(crash_sevr = factor(x = crash_sevr, 
                             levels = c(&quot;No Injury&quot;, 
                                        &quot;Possible Injury&quot;, 
                                        &quot;Suspected Minor Injury&quot;, 
                                        &quot;Suspected Serious Injury&quot;, 
                                        &quot;Killed&quot;, 
                                        &quot;Total&quot;)),
               ambulance_r = case_when(ambulance_r == &quot;Yes&quot; ~ &quot;Ambulance required&quot;, TRUE ~ &quot;No ambulance required&quot;)) %&gt;% 
  ggplot(aes(x = crash_year, y = n, fill = ambulance_r)) + 
  geom_bar(stat = &quot;identity&quot;) + facet_wrap(vars(crash_sevr), scales=&quot;free_y&quot;) + 
  easy_rotate_x_labels() +
  labs(x = element_blank(), y = element_blank()) + 
  theme(legend.position = &quot;bottom&quot;, legend.title = element_blank()) +
  #scale_fill_discrete(labels = c(&quot;No ambulance required&quot;, &quot;Ambulance required&quot;)) +
  scale_fill_manual(&quot;legend&quot;, values = c(&quot;No ambulance required&quot; = &quot;gray80&quot;, &quot;Ambulance required&quot; = &quot;tomato2&quot;)) </code></pre>
<pre><code>## `summarise()` has grouped output by &#39;crash_year&#39;. You can override using the `.groups` argument.</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-1-2.png" width="672" /></p>
<pre class="r"><code># Read in counties geometries
nc_counties &lt;- 
  USAboundaries::us_counties() %&gt;% 
  select(13, namelsad) %&gt;% 
  rename(state = state_name, county = namelsad) %&gt;% 
  filter(state == &quot;North Carolina&quot;) %&gt;% 
  select(-state) %&gt;% 
  st_transform(&quot;NAD83&quot;) # Most common american CRS 

# Initial map
st_as_sf(bike_crash, coords = c(x = &quot;x&quot;, y = &quot;y&quot;), crs = &quot;NAD83&quot;) %&gt;% 
tm_shape() + 
  tm_dots(alpha = 0.2) + 
  tm_shape(nc_counties) + 
  tm_borders(alpha = 0.4, lwd = 1.3) + 
  tm_layout(main.title = &quot;Bikecrashes in North Carolina (2007-2019)&quot;, 
            main.title.position = &quot;center&quot;,
            main.title.fontfamily = &quot;IBM Plex Sans&quot;,
            main.title.size = 1) </code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/Mapping%201-1.png" width="672" /></p>
