---
title: 'Bike Crash 2: The causes of major injuries'
author: "Sighvatur Davidsson"
date: '2022-02-11'
---

<script src="{{< blogdown/postref >}}index.en_files/htmlwidgets/htmlwidgets.js"></script>
<script src="{{< blogdown/postref >}}index.en_files/plotly-binding/plotly.js"></script>
<script src="{{< blogdown/postref >}}index.en_files/typedarray/typedarray.min.js"></script>
<script src="{{< blogdown/postref >}}index.en_files/jquery/jquery.min.js"></script>
<link href="{{< blogdown/postref >}}index.en_files/crosstalk/css/crosstalk.min.css" rel="stylesheet" />
<script src="{{< blogdown/postref >}}index.en_files/crosstalk/js/crosstalk.min.js"></script>
<link href="{{< blogdown/postref >}}index.en_files/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="{{< blogdown/postref >}}index.en_files/plotly-main/plotly-latest.min.js"></script>
<link href="{{< blogdown/postref >}}index.en_files/tabwid/tabwid.css" rel="stylesheet" />


<div id="outline-for-this-post" class="section level3">
<h3>Outline for this post</h3>
<p>In this post I will be using machine learning methods to extrude insights that can be gained from the <em>bike crash</em>-dataset, that I introduced in my <a href="https://sdavidsson.netlify.app/post/2022-01-24-introducing-the-bike-crash-data/">previous post</a>. In the previous post we looked at the information that has been made available in the dataset, and we concluded that we are working with a dataset that is highly qualitative in nature, hence we must choose appropriate machine learning methods. This is the second part in the series:</p>
<ol style="list-style-type: decimal">
<li><a href="https://sdavidsson.netlify.app/post/2022-01-24-introducing-the-bike-crash-data/">Introducing the bike crash-dataset</a></li>
<li>The causes of major injuries</li>
<li><a href="https://sdavidsson.netlify.app/post/2022-02-17-bike-crash-3-gis-tools-using-the-r-command-line/">GIS-tools using the R-command line</a></li>
</ol>
</div>
<div id="the-business-problem" class="section level3">
<h3>The business problem</h3>
<p>Data analytics is essentially useless if we don’t pay close attention to the core business problem we are working on. After all the purpose of machine learning is to gain insights that can be presented to decision makers in order for them to base their decisions on actual data - as opposed to guesswork or general assumptions. Of course this project does not have an actual decision maker on the receiving end, but as this is a critical consideration in data analytics, I don’t want to leave it out.</p>
<div id="vision-zero" class="section level4">
<h4>Vision zero</h4>
<p>In 2015 the North Carolinian transport authorities adopted a new policy for designing the states transportation network. The adoption of this policy legally obliges the authorities to base their traffic improvement measures on the principles of the Vision Zero project. This project strives to reduce the number of traffic related immobilities or deaths to zero.</p>
<p>The principles are derived from a set of ethical imperatives:
- Citizens lives or mobility can never be traded for other societal advantages
- When citizens lives or mobility are affected preventive measures must be taken</p>
<p>Tingvall &amp; Haworth <a href="https://www.monash.edu/muarc/archive/our-publications/papers/visionzero">(1999)</a> describe this as a paradigm shift in traffic planning.</p>
</div>
<div id="thus-the-question-we-are-trying-to-answer-is" class="section level4">
<h4>Thus the question we are trying to answer is:</h4>
</div>
<div id="can-we-identify-risk-factors-that-increase-the-severity-of-accidents" class="section level4">
<h4><em>Can we identify risk factors that increase the severity of accidents?</em></h4>
<p>Using this knowledge we would be able to allocate ressources to improving the conditions that have the biggest effect on the seriousness of accidents.</p>
<pre class="r"><code># Load packages
pacman::p_load(tidyverse,                      # essential tools
               sf, tmap,                       # mapping tools
               plotly,                         # interactive plotting
               hrbrthemes,                     # cool plotting theme
               tidymodels, baguette, themis,   # modeling tools
               flextable                       # for creating beautiful tables
)
               
# Set standard plotting theme
theme_set(theme_ipsum_ps())

# Read in datasets
bike_crash &lt;- read_rds(&quot;~/R/Projects/bike_crash/processed_data/bike_crash.rds&quot;)</code></pre>
</div>
<div id="outcome-variable" class="section level4">
<h4>Outcome variable</h4>
<p>We will we using the variable <em>crash_sevr</em> as our outcome variable.</p>
<pre class="r"><code># Before selecting I like to save the unedited dataset to memory
bike_crash0 &lt;- bike_crash

# Initial plotting of our outcome variable
(
  bike_crash %&gt;%
  count(crash_sevr) %&gt;% 
  ggplot(aes(x = crash_sevr, y = n, fill = crash_sevr, text = paste0(crash_sevr,&quot;: &quot;, n))) +
  geom_col(fill = &quot;grey60&quot;) +
  ggtitle(&quot;Severity of crashes (2007 - 2019)&quot;) +
  labs(x = &quot;&quot;, y = &quot;&quot;) +
  theme(axis.text.x=element_text(angle = 30, hjust = 1))
 ) %&gt;% 
  ggplotly(tooltip = c(&quot;text&quot;)) %&gt;% 
  config(displayModeBar = F)</code></pre>
<div id="htmlwidget-1" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"data":[{"orientation":"v","width":[0.9,0.9,0.9,0.9,0.9,0.9],"base":[0,0,0,0,0,0],"x":[1,2,3,4,5,6],"y":[1396,4716,5057,650,278,76],"text":["No Injury: 1396","Possible Injury: 4716","Suspected Minor Injury: 5057","Suspected Serious Injury: 650","Killed: 278","NA: 76"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(153,153,153,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":95.7011207970112,"r":39.8505603985056,"b":71.5649647156497,"l":67.5799086757991},"font":{"color":"rgba(0,0,0,1)","family":"IBMPlexSans","size":15.2760481527605},"title":{"text":"Severity of crashes (2007 - 2019)","font":{"color":"rgba(0,0,0,1)","family":"IBMPlexSans-Bold","size":23.9103362391034},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.4,6.6],"tickmode":"array","ticktext":["No Injury","Possible Injury","Suspected Minor Injury","Suspected Serious Injury","Killed"],"tickvals":[1,2,3,4,5],"categoryorder":"array","categoryarray":["No Injury","Possible Injury","Suspected Minor Injury","Suspected Serious Injury","Killed"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.81901203819012,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"IBMPlexSans","size":11.9551681195517},"tickangle":-30,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(204,204,204,1)","gridwidth":0.265670402656704,"zeroline":false,"anchor":"y","title":{"text":"","font":{"color":"rgba(0,0,0,1)","family":"IBMPlexSans","size":11.9551681195517}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-252.85,5309.85],"tickmode":"array","ticktext":["0","1000","2000","3000","4000","5000"],"tickvals":[2.8421709430404e-14,1000,2000,3000,4000,5000],"categoryorder":"array","categoryarray":["0","1000","2000","3000","4000","5000"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.81901203819012,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"IBMPlexSans","size":11.9551681195517},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(204,204,204,1)","gridwidth":0.265670402656704,"zeroline":false,"anchor":"x","title":{"text":"","font":{"color":"rgba(0,0,0,1)","family":"IBMPlexSans","size":11.9551681195517}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"IBMPlexSans","size":12.2208385222084}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displayModeBar":false},"source":"A","attrs":{"1318d444021b8":{"x":{},"y":{},"fill":{},"text":{},"type":"bar"}},"cur_data":"1318d444021b8","visdat":{"1318d444021b8":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>Here we see the frequency distribution of the variable categories.</p>
<p>As I demonstrated in <a href="https://sdavidsson.netlify.app/post/2022-01-24-introducing-the-bike-crash-data/">part 1</a> this is very much a qualitative dataset. An obvious choice of machine learning methods is therefore to go with the classification type models - regression type models simply wouldn’t yield meaningful results for non-numerical data.</p>
<p>This calls for a recoding of our variable to a dichotomous outcome.</p>
<pre class="r"><code># Outcome variable should be binary with &quot;positive&quot; outcome marked as 1.

# # # # RECODING # # # # # 
# 
#   We&#39;re predicting crash severeness, so the encoding will be:
#     1: Serious injury or killed
#     0: Minor injuries
bike_crash &lt;- bike_crash %&gt;% 

  # First we filter out NA&#39;s
  filter(!is.na(crash_sevr)) %&gt;% 
  mutate( 
    # Then we use an if_else statement to gather the two most serious categories into &#39;Major Injuries&#39; and the rest to &#39;Minor Injuries&#39;
    crash_sevr = if_else(crash_sevr %in% c(&quot;Killed&quot;, &quot;Suspected Serious Injury&quot;), &quot;Major Injuries&quot;, &quot;Minor Injuries&quot;),
   
    # Finally; most classification models require outcome variable to be coded as factor
    crash_sevr = factor(crash_sevr, levels = c(&quot;Major Injuries&quot;, &quot;Minor Injuries&quot;)))

#  Double check recoded variable
contrasts(bike_crash$crash_sevr)</code></pre>
<pre><code>##                Minor Injuries
## Major Injuries              0
## Minor Injuries              1</code></pre>
<pre class="r"><code># Plotting of outcome variable after recoding
(
  bike_crash %&gt;%
  count(crash_sevr) %&gt;%
  mutate(crash_sevr = fct_rev(crash_sevr)) %&gt;% 
  ggplot(aes(x = crash_sevr, y = n, fill = crash_sevr, text = paste0(crash_sevr,&quot;: &quot;, n))) +
  geom_col(fill = &quot;grey60&quot;) +
  labs(x = &quot;&quot;, y = &quot;&quot;) +
  theme(axis.text.x=element_text(angle = 30, hjust = 1)) 
 ) %&gt;% 
  ggplotly(tooltip = c(&quot;text&quot;)) %&gt;% 
  config(displayModeBar = F)</code></pre>
<div id="htmlwidget-2" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"data":[{"orientation":"v","width":[0.9,0.9],"base":[0,0],"x":[2,1],"y":[928,11169],"text":["Major Injuries: 928","Minor Injuries: 11169"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(153,153,153,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":71.7907845579079,"r":39.8505603985056,"b":71.5649647156497,"l":67.5799086757991},"font":{"color":"rgba(0,0,0,1)","family":"IBMPlexSans","size":15.2760481527605},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.4,2.6],"tickmode":"array","ticktext":["Minor Injuries","Major Injuries"],"tickvals":[1,2],"categoryorder":"array","categoryarray":["Minor Injuries","Major Injuries"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.81901203819012,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"IBMPlexSans","size":11.9551681195517},"tickangle":-30,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(204,204,204,1)","gridwidth":0.265670402656704,"zeroline":false,"anchor":"y","title":{"text":"","font":{"color":"rgba(0,0,0,1)","family":"IBMPlexSans","size":11.9551681195517}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-558.45,11727.45],"tickmode":"array","ticktext":["0","3000","6000","9000"],"tickvals":[0,3000,6000,9000],"categoryorder":"array","categoryarray":["0","3000","6000","9000"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.81901203819012,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"IBMPlexSans","size":11.9551681195517},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(204,204,204,1)","gridwidth":0.265670402656704,"zeroline":false,"anchor":"x","title":{"text":"","font":{"color":"rgba(0,0,0,1)","family":"IBMPlexSans","size":11.9551681195517}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"IBMPlexSans","size":12.2208385222084}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displayModeBar":false},"source":"A","attrs":{"1318d5a7fc0a3":{"x":{},"y":{},"fill":{},"text":{},"type":"bar"}},"cur_data":"1318d5a7fc0a3","visdat":{"1318d5a7fc0a3":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>Here’s an updated frequency distribution of our recoded outcome variable. It is very important to notice that we have class imbalance - ie. more than 90 % of the observations are minor injuries. Remember; our objective is to prevent the major injuries by identifying their contributing causes. Left untouched this distribution will almost certainly harm our ability to create a model that can correctly predict the most severe cases. This will be dealt with in the modelling section.</p>
</div>
<div id="predictor-variables" class="section level4">
<h4>Predictor variables</h4>
<p>In my modeling for this post I will be focusing on environmental variables - ie. factors in the physical environment that can be improved.</p>
<pre class="r"><code># Predictor variables
bike_crash &lt;- bike_crash %&gt;% 
    select(
      # Outcome variable
      crash_sevr, 
      # Environmental variables
      starts_with(&quot;rd_&quot;), light_cond, locality, num_lanes, 
      rural_urban, traff_cntrl, speed_limit, workzone, crash_loc, developmen
      ) 

# Option: Omit all NA
# bike_crash &lt;- na.omit(bike_crash)
# Det gør vi ikke, da vi får en bedre model (på alle parametre), hvis vi lader være

colnames(bike_crash)</code></pre>
<pre><code>##  [1] &quot;crash_sevr&quot;  &quot;rd_bent&quot;     &quot;rd_hill&quot;     &quot;rd_class&quot;    &quot;rd_conditio&quot;
##  [6] &quot;rd_config&quot;   &quot;rd_defects&quot;  &quot;rd_feature&quot;  &quot;rd_surface&quot;  &quot;light_cond&quot; 
## [11] &quot;locality&quot;    &quot;num_lanes&quot;   &quot;rural_urban&quot; &quot;traff_cntrl&quot; &quot;speed_limit&quot;
## [16] &quot;workzone&quot;    &quot;crash_loc&quot;   &quot;developmen&quot;</code></pre>
</div>
</div>
<div id="modelling" class="section level3">
<h3>Modelling</h3>
<p>We are now in place to begin our modelling. I will be using testing two different methods against each other; logistic regression and a random forest with bagging.</p>
<pre class="r"><code># I will be modelling using the tidymodels package
# This package was loaded in a previous chunk

# Tidymodels offer control over which model engine to select. 

# Logistic regression
logreg &lt;- logistic_reg() %&gt;% 
  set_engine(engine = &quot;glm&quot;) %&gt;%  
  set_mode(&quot;classification&quot;)

# Bagged random forest (reqires baguette package)
bagged &lt;- bag_tree(min_n = 10) %&gt;%
  set_engine(&quot;rpart&quot;, times = 25) %&gt;%
  set_mode(&quot;classification&quot;)

# Define model rest metrics
custom_metrics &lt;- metric_set(accuracy, roc_auc, sensitivity, specificity)</code></pre>
<p>We of course have to split the dataset into a train and test set:</p>
<pre class="r"><code># Data split for training model
set.seed(512)
bike_split &lt;- initial_split(bike_crash, prop = 0.75, strata = crash_sevr) 
bike_train &lt;- bike_split %&gt;% training()
bike_test &lt;- bike_split %&gt;% testing()

# Cross validation for folds for higher prediction accuracy
set.seed(666)
bike_folds &lt;- vfold_cv(bike_train, v = 10, prop = 0.75,  strata = crash_sevr)

# Define model test metrics
bike_metrics &lt;- metric_set(accuracy, roc_auc, sensitivity, specificity)

# Specify the model formula (outcomes + predictors)
formula &lt;- formula(crash_sevr ~ .)</code></pre>
<p>Here are is an initial run of these models:</p>
<pre class="r"><code># Define recipe
bike_recipe &lt;- 
  recipe(formula, data = bike_train) %&gt;% 
  step_dummy(all_nominal(), -all_outcomes()) 

# Logistic regression workflow
bc_logreg_wf &lt;- workflow() %&gt;% 
  add_recipe(bike_recipe)  %&gt;% 
  add_model(logreg)

# Random forest workflow
bc_bagged_wf &lt;- workflow() %&gt;% 
  add_recipe(bike_recipe)  %&gt;% 
  add_model(bagged)

# We wan&#39;t to collect predictions
ctrl_preds &lt;- control_resamples(save_pred = TRUE)

# Let&#39;s fit!
bc_logreg_fit &lt;- fit_resamples(bc_logreg_wf, bike_folds, metrics = custom_metrics, control = ctrl_preds) 
bc_bagged_fit &lt;- fit_resamples(bc_bagged_wf, bike_folds, metrics = custom_metrics, control = ctrl_preds)

# And evaluate
collect_metrics(bc_logreg_fit) %&gt;% 
  select(-.config, -n) %&gt;% 
  mutate(mean = round(mean, 3),
         std_err = round(std_err, 3)) %&gt;% 
  flextable() %&gt;% add_header_lines(&quot;Logistic regression model&quot;)</code></pre>
<template id="876b82de-ad53-47f4-8bde-bade00092a3d"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-da57b610{}.cl-da4df0d0{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-da4e1a88{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-da4e1a92{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-da4e6286{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-da4e6290{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-da4e629a{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-da4e629b{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-da4e62a4{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-da4e62ae{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-da57b610'>
<thead><tr style="overflow-wrap:break-word;"><td  colspan="4"class="cl-da4e62a4"><p class="cl-da4e1a88"><span class="cl-da4df0d0">Logistic regression model</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-da4e62a4"><p class="cl-da4e1a88"><span class="cl-da4df0d0">.metric</span></p></td><td class="cl-da4e62a4"><p class="cl-da4e1a88"><span class="cl-da4df0d0">.estimator</span></p></td><td class="cl-da4e62ae"><p class="cl-da4e1a92"><span class="cl-da4df0d0">mean</span></p></td><td class="cl-da4e62ae"><p class="cl-da4e1a92"><span class="cl-da4df0d0">std_err</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-da4e6286"><p class="cl-da4e1a88"><span class="cl-da4df0d0">accuracy</span></p></td><td class="cl-da4e6286"><p class="cl-da4e1a88"><span class="cl-da4df0d0">binary</span></p></td><td class="cl-da4e6290"><p class="cl-da4e1a92"><span class="cl-da4df0d0">0.917</span></p></td><td class="cl-da4e6290"><p class="cl-da4e1a92"><span class="cl-da4df0d0">0.004</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-da4e6286"><p class="cl-da4e1a88"><span class="cl-da4df0d0">roc_auc</span></p></td><td class="cl-da4e6286"><p class="cl-da4e1a88"><span class="cl-da4df0d0">binary</span></p></td><td class="cl-da4e6290"><p class="cl-da4e1a92"><span class="cl-da4df0d0">0.712</span></p></td><td class="cl-da4e6290"><p class="cl-da4e1a92"><span class="cl-da4df0d0">0.013</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-da4e6286"><p class="cl-da4e1a88"><span class="cl-da4df0d0">sensitivity</span></p></td><td class="cl-da4e6286"><p class="cl-da4e1a88"><span class="cl-da4df0d0">binary</span></p></td><td class="cl-da4e6290"><p class="cl-da4e1a92"><span class="cl-da4df0d0">0.004</span></p></td><td class="cl-da4e6290"><p class="cl-da4e1a92"><span class="cl-da4df0d0">0.002</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-da4e629a"><p class="cl-da4e1a88"><span class="cl-da4df0d0">specificity</span></p></td><td class="cl-da4e629a"><p class="cl-da4e1a88"><span class="cl-da4df0d0">binary</span></p></td><td class="cl-da4e629b"><p class="cl-da4e1a92"><span class="cl-da4df0d0">0.999</span></p></td><td class="cl-da4e629b"><p class="cl-da4e1a92"><span class="cl-da4df0d0">0.001</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="9213f009-b18e-46a3-8d02-d095e626da23"></div>
<script>
var dest = document.getElementById("9213f009-b18e-46a3-8d02-d095e626da23");
var template = document.getElementById("876b82de-ad53-47f4-8bde-bade00092a3d");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<pre class="r"><code>collect_metrics(bc_bagged_fit) %&gt;% 
  select(-.config, -n) %&gt;% 
  mutate(mean = round(mean, 3),
         std_err = round(std_err, 3)) %&gt;% 
  flextable() %&gt;% add_header_lines(&quot;Bagged random forest model&quot;)</code></pre>
<template id="baac7429-5574-4137-8d02-c48e8b3880e3"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-da73a514{}.cl-da6cd9aa{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-da6ce9f4{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-da6ce9fe{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-da6d237e{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-da6d2392{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-da6d239c{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-da6d23a6{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-da6d23a7{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-da6d23b0{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-da73a514'>
<thead><tr style="overflow-wrap:break-word;"><td  colspan="4"class="cl-da6d23a7"><p class="cl-da6ce9f4"><span class="cl-da6cd9aa">Bagged random forest model</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-da6d23a7"><p class="cl-da6ce9f4"><span class="cl-da6cd9aa">.metric</span></p></td><td class="cl-da6d23a7"><p class="cl-da6ce9f4"><span class="cl-da6cd9aa">.estimator</span></p></td><td class="cl-da6d23b0"><p class="cl-da6ce9fe"><span class="cl-da6cd9aa">mean</span></p></td><td class="cl-da6d23b0"><p class="cl-da6ce9fe"><span class="cl-da6cd9aa">std_err</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-da6d237e"><p class="cl-da6ce9f4"><span class="cl-da6cd9aa">accuracy</span></p></td><td class="cl-da6d237e"><p class="cl-da6ce9f4"><span class="cl-da6cd9aa">binary</span></p></td><td class="cl-da6d2392"><p class="cl-da6ce9fe"><span class="cl-da6cd9aa">0.921</span></p></td><td class="cl-da6d2392"><p class="cl-da6ce9fe"><span class="cl-da6cd9aa">0.004</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-da6d237e"><p class="cl-da6ce9f4"><span class="cl-da6cd9aa">roc_auc</span></p></td><td class="cl-da6d237e"><p class="cl-da6ce9f4"><span class="cl-da6cd9aa">binary</span></p></td><td class="cl-da6d2392"><p class="cl-da6ce9fe"><span class="cl-da6cd9aa">0.690</span></p></td><td class="cl-da6d2392"><p class="cl-da6ce9fe"><span class="cl-da6cd9aa">0.008</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-da6d237e"><p class="cl-da6ce9f4"><span class="cl-da6cd9aa">sensitivity</span></p></td><td class="cl-da6d237e"><p class="cl-da6ce9f4"><span class="cl-da6cd9aa">binary</span></p></td><td class="cl-da6d2392"><p class="cl-da6ce9fe"><span class="cl-da6cd9aa">0.011</span></p></td><td class="cl-da6d2392"><p class="cl-da6ce9fe"><span class="cl-da6cd9aa">0.004</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-da6d239c"><p class="cl-da6ce9f4"><span class="cl-da6cd9aa">specificity</span></p></td><td class="cl-da6d239c"><p class="cl-da6ce9f4"><span class="cl-da6cd9aa">binary</span></p></td><td class="cl-da6d23a6"><p class="cl-da6ce9fe"><span class="cl-da6cd9aa">0.997</span></p></td><td class="cl-da6d23a6"><p class="cl-da6ce9fe"><span class="cl-da6cd9aa">0.001</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="9bd2af66-bcdb-4231-84ba-2955357f3047"></div>
<script>
var dest = document.getElementById("9bd2af66-bcdb-4231-84ba-2955357f3047");
var template = document.getElementById("baac7429-5574-4137-8d02-c48e8b3880e3");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<p>In the initial modelling we get a very high accuracy for our models - indicating that it makes correct predictions more than 90 % of the time. This would be a great result if it weren’t for the class imbalance we noticed earlier. This means the dataset is biased towards predicting cases that belong to the major class, and thus doesn’t necissarily predict the minor class accurately. This is why we need to look at the sensitivity measure. Around 1 % of the time we get correct predictions of the minor class. Considering this is the class we are most interested in predicting correctly, that’s bad!</p>
<p>We could adjust our model threshold in order to get a higher sensitivity (catch more severe cases), but that would harm our accuracy thus not resulting in better model.</p>
<p>Because of this we will now try two different algorithms to <em>resample the dataset</em>; the rose algorithm; and the downsample-algorithm. These two represent to different ways of resampling. The rose algorithm utilises a k-nearest neighbour algorithm to generate more observations of the minor class in order to balance the outcome class. The downsample algorithm balances the observations by reducing the major class. Therefore they represent two opposite approaches to handling class imbalance.</p>
<pre class="r"><code># For one recipe set we apply the rose algorithm
set.seed(444)
bike_recipe_rose &lt;- 
bike_recipe %&gt;% 
  step_rose(crash_sevr) 

# And for the other we test the downsampling algorithm. 
set.seed(555)
bike_recipe_down &lt;- 
bike_recipe %&gt;% 
  step_downsample(crash_sevr) 

# ROSE
bc_logreg_rose_wf &lt;- workflow() %&gt;% 
  add_recipe(bike_recipe_rose)  %&gt;% 
  add_model(logreg)

bc_bagged_rose_wf &lt;- workflow() %&gt;% 
  add_recipe(bike_recipe_rose)  %&gt;% 
  add_model(bagged)

# DOWN
bc_logreg_down_wf &lt;- workflow() %&gt;% 
  add_recipe(bike_recipe_down)  %&gt;% 
  add_model(logreg)

bc_bagged_down_wf &lt;- workflow() %&gt;% 
  add_recipe(bike_recipe_down)  %&gt;% 
  add_model(bagged)

# Let&#39;s fit!
bc_logreg_rose_fit &lt;- fit_resamples(bc_logreg_rose_wf, bike_folds, metrics = custom_metrics, control = ctrl_preds)
bc_bagged_rose_fit &lt;- fit_resamples(bc_bagged_rose_wf, bike_folds, metrics = custom_metrics, control = ctrl_preds)

bc_logreg_down_fit &lt;- fit_resamples(bc_logreg_down_wf, bike_folds, metrics = custom_metrics, control = ctrl_preds)
bc_bagged_down_fit &lt;- fit_resamples(bc_bagged_down_wf, bike_folds, metrics = custom_metrics, control = ctrl_preds)


# And evaluate the rose algorithm 
collect_metrics(bc_logreg_rose_fit) %&gt;%
  select(-.config, -n) %&gt;% 
  mutate(mean = round(mean, 3),
         std_err = round(std_err, 3)) %&gt;% 
  flextable() %&gt;% 
  add_header_lines(&quot;Logistic regression model (with rose-resampling)&quot;)</code></pre>
<template id="4c7725cc-57c3-4a61-bfdb-e9ea23fdc4e2"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-89926fd0{}.cl-898be6ec{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-898bf772{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-898bf77c{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-898c3106{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-898c3110{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-898c311a{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-898c311b{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-898c3124{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-898c3125{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-89926fd0'>
<thead><tr style="overflow-wrap:break-word;"><td  colspan="4"class="cl-898c3124"><p class="cl-898bf772"><span class="cl-898be6ec">Logistic regression model (with rose-resampling)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-898c3124"><p class="cl-898bf772"><span class="cl-898be6ec">.metric</span></p></td><td class="cl-898c3124"><p class="cl-898bf772"><span class="cl-898be6ec">.estimator</span></p></td><td class="cl-898c3125"><p class="cl-898bf77c"><span class="cl-898be6ec">mean</span></p></td><td class="cl-898c3125"><p class="cl-898bf77c"><span class="cl-898be6ec">std_err</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-898c3106"><p class="cl-898bf772"><span class="cl-898be6ec">accuracy</span></p></td><td class="cl-898c3106"><p class="cl-898bf772"><span class="cl-898be6ec">binary</span></p></td><td class="cl-898c3110"><p class="cl-898bf77c"><span class="cl-898be6ec">0.707</span></p></td><td class="cl-898c3110"><p class="cl-898bf77c"><span class="cl-898be6ec">0.004</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-898c3106"><p class="cl-898bf772"><span class="cl-898be6ec">roc_auc</span></p></td><td class="cl-898c3106"><p class="cl-898bf772"><span class="cl-898be6ec">binary</span></p></td><td class="cl-898c3110"><p class="cl-898bf77c"><span class="cl-898be6ec">0.715</span></p></td><td class="cl-898c3110"><p class="cl-898bf77c"><span class="cl-898be6ec">0.014</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-898c3106"><p class="cl-898bf772"><span class="cl-898be6ec">sensitivity</span></p></td><td class="cl-898c3106"><p class="cl-898bf772"><span class="cl-898be6ec">binary</span></p></td><td class="cl-898c3110"><p class="cl-898bf77c"><span class="cl-898be6ec">0.618</span></p></td><td class="cl-898c3110"><p class="cl-898bf77c"><span class="cl-898be6ec">0.028</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-898c311a"><p class="cl-898bf772"><span class="cl-898be6ec">specificity</span></p></td><td class="cl-898c311a"><p class="cl-898bf772"><span class="cl-898be6ec">binary</span></p></td><td class="cl-898c311b"><p class="cl-898bf77c"><span class="cl-898be6ec">0.714</span></p></td><td class="cl-898c311b"><p class="cl-898bf77c"><span class="cl-898be6ec">0.005</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="270f537f-5ffa-45f5-8ea0-d1745b4bfdee"></div>
<script>
var dest = document.getElementById("270f537f-5ffa-45f5-8ea0-d1745b4bfdee");
var template = document.getElementById("4c7725cc-57c3-4a61-bfdb-e9ea23fdc4e2");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<pre class="r"><code>collect_metrics(bc_bagged_rose_fit) %&gt;% 
  select(-.config, -n) %&gt;% 
  mutate(mean = round(mean, 3),
         std_err = round(std_err, 3)) %&gt;% 
  flextable() %&gt;% 
  add_header_lines(&quot;Bagged random forest model (with rose-resampling)&quot;)</code></pre>
<template id="0e2d48da-0658-44d5-9904-d47ca2927629"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-89ad81c6{}.cl-89a70d14{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-89a71d36{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-89a71d40{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-89a75fe4{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-89a75fee{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-89a75fef{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-89a75ff8{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-89a75ff9{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-89a75ffa{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-89ad81c6'>
<thead><tr style="overflow-wrap:break-word;"><td  colspan="4"class="cl-89a75ff9"><p class="cl-89a71d36"><span class="cl-89a70d14">Bagged random forest model (with rose-resampling)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-89a75ff9"><p class="cl-89a71d36"><span class="cl-89a70d14">.metric</span></p></td><td class="cl-89a75ff9"><p class="cl-89a71d36"><span class="cl-89a70d14">.estimator</span></p></td><td class="cl-89a75ffa"><p class="cl-89a71d40"><span class="cl-89a70d14">mean</span></p></td><td class="cl-89a75ffa"><p class="cl-89a71d40"><span class="cl-89a70d14">std_err</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-89a75fe4"><p class="cl-89a71d36"><span class="cl-89a70d14">accuracy</span></p></td><td class="cl-89a75fe4"><p class="cl-89a71d36"><span class="cl-89a70d14">binary</span></p></td><td class="cl-89a75fee"><p class="cl-89a71d40"><span class="cl-89a70d14">0.078</span></p></td><td class="cl-89a75fee"><p class="cl-89a71d40"><span class="cl-89a70d14">0.004</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-89a75fe4"><p class="cl-89a71d36"><span class="cl-89a70d14">roc_auc</span></p></td><td class="cl-89a75fe4"><p class="cl-89a71d36"><span class="cl-89a70d14">binary</span></p></td><td class="cl-89a75fee"><p class="cl-89a71d40"><span class="cl-89a70d14">0.499</span></p></td><td class="cl-89a75fee"><p class="cl-89a71d40"><span class="cl-89a70d14">0.002</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-89a75fe4"><p class="cl-89a71d36"><span class="cl-89a70d14">sensitivity</span></p></td><td class="cl-89a75fe4"><p class="cl-89a71d36"><span class="cl-89a70d14">binary</span></p></td><td class="cl-89a75fee"><p class="cl-89a71d40"><span class="cl-89a70d14">1.000</span></p></td><td class="cl-89a75fee"><p class="cl-89a71d40"><span class="cl-89a70d14">0.000</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-89a75fef"><p class="cl-89a71d36"><span class="cl-89a70d14">specificity</span></p></td><td class="cl-89a75fef"><p class="cl-89a71d36"><span class="cl-89a70d14">binary</span></p></td><td class="cl-89a75ff8"><p class="cl-89a71d40"><span class="cl-89a70d14">0.001</span></p></td><td class="cl-89a75ff8"><p class="cl-89a71d40"><span class="cl-89a70d14">0.000</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="f453cdce-4efc-4e77-9668-d34ab62598d8"></div>
<script>
var dest = document.getElementById("f453cdce-4efc-4e77-9668-d34ab62598d8");
var template = document.getElementById("0e2d48da-0658-44d5-9904-d47ca2927629");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<pre class="r"><code># And evaluate the downsample algorithm 
collect_metrics(bc_logreg_down_fit) %&gt;% 
  select(-.config, -n) %&gt;% 
  mutate(mean = round(mean, 3),
         std_err = round(std_err, 3)) %&gt;% 
  flextable() %&gt;% 
add_header_lines(&quot;Logistic regression model (with downsampling)&quot;)</code></pre>
<template id="95743d7f-4f36-42ce-bbe0-564f4f4506a9"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-89c8be46{}.cl-89bf8894{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-89bf9bf4{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-89bf9bfe{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-89bfd740{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-89bfd74a{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-89bfd74b{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-89bfd754{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-89bfd755{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-89bfd75e{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-89c8be46'>
<thead><tr style="overflow-wrap:break-word;"><td  colspan="4"class="cl-89bfd755"><p class="cl-89bf9bf4"><span class="cl-89bf8894">Logistic regression model (with downsampling)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-89bfd755"><p class="cl-89bf9bf4"><span class="cl-89bf8894">.metric</span></p></td><td class="cl-89bfd755"><p class="cl-89bf9bf4"><span class="cl-89bf8894">.estimator</span></p></td><td class="cl-89bfd75e"><p class="cl-89bf9bfe"><span class="cl-89bf8894">mean</span></p></td><td class="cl-89bfd75e"><p class="cl-89bf9bfe"><span class="cl-89bf8894">std_err</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-89bfd740"><p class="cl-89bf9bf4"><span class="cl-89bf8894">accuracy</span></p></td><td class="cl-89bfd740"><p class="cl-89bf9bf4"><span class="cl-89bf8894">binary</span></p></td><td class="cl-89bfd74a"><p class="cl-89bf9bfe"><span class="cl-89bf8894">0.643</span></p></td><td class="cl-89bfd74a"><p class="cl-89bf9bfe"><span class="cl-89bf8894">0.005</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-89bfd740"><p class="cl-89bf9bf4"><span class="cl-89bf8894">roc_auc</span></p></td><td class="cl-89bfd740"><p class="cl-89bf9bf4"><span class="cl-89bf8894">binary</span></p></td><td class="cl-89bfd74a"><p class="cl-89bf9bfe"><span class="cl-89bf8894">0.711</span></p></td><td class="cl-89bfd74a"><p class="cl-89bf9bfe"><span class="cl-89bf8894">0.008</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-89bfd740"><p class="cl-89bf9bf4"><span class="cl-89bf8894">sensitivity</span></p></td><td class="cl-89bfd740"><p class="cl-89bf9bf4"><span class="cl-89bf8894">binary</span></p></td><td class="cl-89bfd74a"><p class="cl-89bf9bfe"><span class="cl-89bf8894">0.692</span></p></td><td class="cl-89bfd74a"><p class="cl-89bf9bfe"><span class="cl-89bf8894">0.012</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-89bfd74b"><p class="cl-89bf9bf4"><span class="cl-89bf8894">specificity</span></p></td><td class="cl-89bfd74b"><p class="cl-89bf9bf4"><span class="cl-89bf8894">binary</span></p></td><td class="cl-89bfd754"><p class="cl-89bf9bfe"><span class="cl-89bf8894">0.639</span></p></td><td class="cl-89bfd754"><p class="cl-89bf9bfe"><span class="cl-89bf8894">0.005</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="3fea569c-90dc-4f23-99d6-b91892fae789"></div>
<script>
var dest = document.getElementById("3fea569c-90dc-4f23-99d6-b91892fae789");
var template = document.getElementById("95743d7f-4f36-42ce-bbe0-564f4f4506a9");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<pre class="r"><code>collect_metrics(bc_bagged_down_fit) %&gt;% 
  select(-.config, -n) %&gt;% 
  mutate(mean = round(mean, 3),
         std_err = round(std_err, 3)) %&gt;% 
  flextable() %&gt;% 
  add_header_lines(&quot;Bagged random forest model (with downsampling)&quot;)</code></pre>
<template id="25baa3b4-2492-4508-ac3c-dd3a78c1e496"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-89e2d0ec{}.cl-89dc1176{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-89dc21d4{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-89dc21d5{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-89dc625c{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-89dc6266{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-89dc6267{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-89dc6270{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-89dc6271{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-89dc627a{width:54pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-89e2d0ec'>
<thead><tr style="overflow-wrap:break-word;"><td  colspan="4"class="cl-89dc6271"><p class="cl-89dc21d4"><span class="cl-89dc1176">Bagged random forest model (with downsampling)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-89dc6271"><p class="cl-89dc21d4"><span class="cl-89dc1176">.metric</span></p></td><td class="cl-89dc6271"><p class="cl-89dc21d4"><span class="cl-89dc1176">.estimator</span></p></td><td class="cl-89dc627a"><p class="cl-89dc21d5"><span class="cl-89dc1176">mean</span></p></td><td class="cl-89dc627a"><p class="cl-89dc21d5"><span class="cl-89dc1176">std_err</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-89dc625c"><p class="cl-89dc21d4"><span class="cl-89dc1176">accuracy</span></p></td><td class="cl-89dc625c"><p class="cl-89dc21d4"><span class="cl-89dc1176">binary</span></p></td><td class="cl-89dc6266"><p class="cl-89dc21d5"><span class="cl-89dc1176">0.647</span></p></td><td class="cl-89dc6266"><p class="cl-89dc21d5"><span class="cl-89dc1176">0.004</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-89dc625c"><p class="cl-89dc21d4"><span class="cl-89dc1176">roc_auc</span></p></td><td class="cl-89dc625c"><p class="cl-89dc21d4"><span class="cl-89dc1176">binary</span></p></td><td class="cl-89dc6266"><p class="cl-89dc21d5"><span class="cl-89dc1176">0.699</span></p></td><td class="cl-89dc6266"><p class="cl-89dc21d5"><span class="cl-89dc1176">0.005</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-89dc625c"><p class="cl-89dc21d4"><span class="cl-89dc1176">sensitivity</span></p></td><td class="cl-89dc625c"><p class="cl-89dc21d4"><span class="cl-89dc1176">binary</span></p></td><td class="cl-89dc6266"><p class="cl-89dc21d5"><span class="cl-89dc1176">0.661</span></p></td><td class="cl-89dc6266"><p class="cl-89dc21d5"><span class="cl-89dc1176">0.017</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-89dc6267"><p class="cl-89dc21d4"><span class="cl-89dc1176">specificity</span></p></td><td class="cl-89dc6267"><p class="cl-89dc21d4"><span class="cl-89dc1176">binary</span></p></td><td class="cl-89dc6270"><p class="cl-89dc21d5"><span class="cl-89dc1176">0.646</span></p></td><td class="cl-89dc6270"><p class="cl-89dc21d5"><span class="cl-89dc1176">0.005</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="ec1a0c0a-5b13-4a0a-9b04-c0698b4b812c"></div>
<script>
var dest = document.getElementById("ec1a0c0a-5b13-4a0a-9b04-c0698b4b812c");
var template = document.getElementById("25baa3b4-2492-4508-ac3c-dd3a78c1e496");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<p>We see that the rose algorithm has had a dramatic effect on the logistic regression model, but seems not to have had a great effect on the bagged RF model, which seems to not be working.</p>
<p>It also looks as if the downsampling algorithm has had a positive effect on both models. In both models get a lower accuracy and ROC-AUC (compared to no resampling) but again our sensitivity has increased by a lot, suggesting this model is better able to confine the relationship with our predictors and the outcome variable.</p>
<div id="model-selection" class="section level4">
<h4>Model selection</h4>
<p>But which model do we choose? Since both tables indicate very similar results, neither model is a clear winner.</p>
<p>Considering there is an element of randomness in both the initial train/test-splitting of the dataset and in applying the resampling algorithms, it is very possible that these minute differences could pushed in either direction if we were to set different seeds.</p>
<p>We want to select the model that is best able to predict true positives (ie. has the highest sensitivity) but also retains an ability to correctly predict true negatives (high specificity). The ROC-AUC is a measure that looks at both the specificity and sensitivity combined and is therefore useful for comparing models. In this case however I would argue that it would be misleading to select the model with the highest AUC. This is because of the class imbalance problem in our outcome variable. Without resampling the ROC-AUC is (somewhat) high for both the logistic regression model and the random forest model.</p>
<p>For our business problem it is however critical that our model is able to capture the effects leading to major injuries. I therefore suggest we go with the logistic regression model with the rose resampling.</p>
</div>
<div id="evaluating-the-model-on-the-test-set" class="section level4">
<h4>Evaluating the model on the test set</h4>
<p>Running our model on test data yields quite similar results. We would of course prefer a model that comes closer to a 100 % in accuracy, but this was not possible this time.</p>
<p>There are elements of randomness in the splitting procedure (into training and testing set) and in the rose-algorithm. Setting a different seed might yield different results, but as these would be due to chance it is not a very good strategy for model improvement.</p>
<p>As I showed in my first post this is very much a qualitative dataset. This greatly limits the variation in the dataset,</p>
<pre class="r"><code># EVALUATE MODEL ON TEST DATA
bike_last_fit &lt;- last_fit(bc_logreg_rose_wf, bike_split)

# Define test metrics
results &lt;- tibble(
  estimate = bike_last_fit$.predictions[[1]]$.pred_class,
  truth = bike_test$crash_sevr)

# View model test metrics
bind_rows(
collect_metrics(bike_last_fit),
sensitivity(results, truth, estimate),
specificity(results, truth, estimate))%&gt;%
  select(-.config, -.estimator) %&gt;% 
  mutate(.estimate = round(.estimate, 3)) %&gt;% 
  flextable() %&gt;%  width(width = 1.71) %&gt;% 
  add_header_lines(&quot;Logistic regression model (with rose-resampling)&quot;)</code></pre>
<template id="05559944-692e-4251-acf7-5a5e9904b124"><style>
.tabwid table{
  border-spacing:0px !important;
  border-collapse:collapse;
  line-height:1;
  margin-left:auto;
  margin-right:auto;
  border-width: 0;
  display: table;
  margin-top: 1.275em;
  margin-bottom: 1.275em;
  border-color: transparent;
}
.tabwid_left table{
  margin-left:0;
}
.tabwid_right table{
  margin-right:0;
}
.tabwid td {
    padding: 0;
}
.tabwid a {
  text-decoration: none;
}
.tabwid thead {
    background-color: transparent;
}
.tabwid tfoot {
    background-color: transparent;
}
.tabwid table tr {
background-color: transparent;
}
</style><div class="tabwid"><style>.cl-8b09249e{}.cl-8b02e3c2{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-8b02f3e4{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-8b02f3ee{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-8b03262a{width:123.1pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8b03263e{width:123.1pt;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8b03263f{width:123.1pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8b032640{width:123.1pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8b032648{width:123.1pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-8b032649{width:123.1pt;background-color:transparent;vertical-align: middle;border-bottom: 2pt solid rgba(102, 102, 102, 1.00);border-top: 2pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table class='cl-8b09249e'>
<thead><tr style="overflow-wrap:break-word;"><td  colspan="2"class="cl-8b032649"><p class="cl-8b02f3e4"><span class="cl-8b02e3c2">Logistic regression model (with rose-resampling)</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-8b032649"><p class="cl-8b02f3e4"><span class="cl-8b02e3c2">.metric</span></p></td><td class="cl-8b032648"><p class="cl-8b02f3ee"><span class="cl-8b02e3c2">.estimate</span></p></td></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-8b03262a"><p class="cl-8b02f3e4"><span class="cl-8b02e3c2">accuracy</span></p></td><td class="cl-8b03263e"><p class="cl-8b02f3ee"><span class="cl-8b02e3c2">0.718</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-8b03262a"><p class="cl-8b02f3e4"><span class="cl-8b02e3c2">roc_auc</span></p></td><td class="cl-8b03263e"><p class="cl-8b02f3ee"><span class="cl-8b02e3c2">0.752</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-8b03262a"><p class="cl-8b02f3e4"><span class="cl-8b02e3c2">sensitivity</span></p></td><td class="cl-8b03263e"><p class="cl-8b02f3ee"><span class="cl-8b02e3c2">0.691</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-8b032640"><p class="cl-8b02f3e4"><span class="cl-8b02e3c2">specificity</span></p></td><td class="cl-8b03263f"><p class="cl-8b02f3ee"><span class="cl-8b02e3c2">0.720</span></p></td></tr></tbody></table></div></template>
<div class="flextable-shadow-host" id="ff07b858-aa9b-4505-bfaa-7fc23b3944d9"></div>
<script>
var dest = document.getElementById("ff07b858-aa9b-4505-bfaa-7fc23b3944d9");
var template = document.getElementById("05559944-692e-4251-acf7-5a5e9904b124");
var caption = template.content.querySelector("caption");
if(caption) {
  caption.style.cssText = "display:block;text-align:center;";
  var newcapt = document.createElement("p");
  newcapt.appendChild(caption)
  dest.parentNode.insertBefore(newcapt, dest.previousSibling);
}
var fantome = dest.attachShadow({mode: 'open'});
var templateContent = template.content;
fantome.appendChild(templateContent);
</script>

<pre class="r"><code># ROC-curve
roc_data &lt;- tibble(
pred  = bike_last_fit$.predictions[[1]] %&gt;% pull(`.pred_Major Injuries`), 
truth = bike_test$crash_sevr)

roc_curve(roc_data,
          truth = truth, 
          estimate = pred) %&gt;% 
  ggplot(aes(x = 1- specificity, y = sensitivity)) +
  geom_path() +
  coord_equal() +
  geom_abline(lty = 3)</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>With these test metrics in mind we can take a cautious look at the factors contributing to the serious accidents. In order to make interpretation easier I have exponentiated the estimates, which displays the results as odds-ratios. I have also filtered out variables that have a p-value below 0.05, so only significant effects are displayed. Furthermore standard errors are displayed as the error bars sticking out from the OR.</p>
<p>Overall road conditions seem to be a contributing factor. Gravel roads increase the likelihood of major accidents by a factor of 4.6. It is likely that these roads also have a number of other features interacting with the crash probabilities. We could try to explore these interaction effects methodically but that is a proces that requires great computational power and I will therefore restrain from doing this on my dual-core PC. An obvious recommendation for decision makers would be to improve conditions on gravel roads.</p>
<p>Also flashing stop and go signals could be replaced with a regular stop and go signal and a dramatic effect would be achieved.</p>
<pre class="r"><code># Clean up x_variable names
vars &lt;- bike_last_fit$.workflow[[1]]$fit$fit$preproc$x_var

vars &lt;- 
str_replace_all(vars, pattern = &quot;X|_|\\.|\\s+&quot;, &quot; &quot;) %&gt;% 
  str_replace_all(pattern = &quot;\\s+&quot;, &quot; &quot; ) %&gt;% 
  str_to_title()

# Visualise variables
(
bike_last_fit %&gt;% 
  pull(.workflow) %&gt;% 
  pluck(1) %&gt;% 
  tidy(exponentiate = TRUE) %&gt;% 
  filter(term != &quot;(Intercept)&quot;,
         p.value &lt; 0.05) %&gt;% 
  ggplot(aes(x = estimate, y = fct_reorder(term, estimate))) + 
  geom_point(aes(x = estimate)) +
  geom_errorbar(aes(
    xmin = estimate - std.error,
    xmax = estimate  + std.error )) +
  labs(x = &quot;Odds Ratio + standard_error&quot;, y = &quot;Variable&quot;)
) %&gt;% 
  ggplotly(tooltip = &quot;estimate&quot;, autosize = F, height = 750, width = 700) %&gt;% 
  config(displayModeBar = F)</code></pre>
<div id="htmlwidget-3" style="width:700px;height:750px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"data":[{"x":[1.20138300527877,0.829565082166465,1.20477005736006,0.83832115580042,1.91411391374165,0.874529669445437,0.731882499392058,0.905859795463445,0.575335919168738,1.19162716313017,1.20544718337448,0.186584070338081,3.74814892655978,0.669539199530742,2.41894775621083,0.305195596498228,0.668118704482198,4.57726000064948,0.397821577624412,1.33330027964144,0.804458120939587,0.846730999200689,0.332612823212714,1.18358667932511,1.16655807670907,3.99210987579517,0.911893783530516,0.604973487288608,1.3279551346603,1.35806788096178,1.19566290884514,0.859782761411197,0.663919655839934,0.528768173362126,0.8844881972261,1.52641477623411,0.791062201537263,0.523418451332002,0.895416216509333],"y":[28,15,29,16,35,19,12,22,7,26,30,1,37,11,36,2,10,39,4,32,14,17,3,25,24,38,23,8,31,33,27,18,9,6,20,34,13,5,21],"text":["estimate: 1.2013830","estimate: 0.8295651","estimate: 1.2047701","estimate: 0.8383212","estimate: 1.9141139","estimate: 0.8745297","estimate: 0.7318825","estimate: 0.9058598","estimate: 0.5753359","estimate: 1.1916272","estimate: 1.2054472","estimate: 0.1865841","estimate: 3.7481489","estimate: 0.6695392","estimate: 2.4189478","estimate: 0.3051956","estimate: 0.6681187","estimate: 4.5772600","estimate: 0.3978216","estimate: 1.3333003","estimate: 0.8044581","estimate: 0.8467310","estimate: 0.3326128","estimate: 1.1835867","estimate: 1.1665581","estimate: 3.9921099","estimate: 0.9118938","estimate: 0.6049735","estimate: 1.3279551","estimate: 1.3580679","estimate: 1.1956629","estimate: 0.8597828","estimate: 0.6639197","estimate: 0.5287682","estimate: 0.8844882","estimate: 1.5264148","estimate: 0.7910622","estimate: 0.5234185","estimate: 0.8954162"],"type":"scatter","mode":"markers+lines","marker":{"autocolorscale":false,"color":"rgba(0,0,0,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,0,0,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","opacity":1,"line":{"color":"transparent"},"error_x":{"array":[0.0490128603115776,0.030628541881533,0.0321802968978893,0.0427695019333593,0.101450014463856,0.0357821178252387,0.0433628187322119,0.0460691384369728,0.14652564499611,0.0822190366991034,0.0719038203636,0.334112985635702,0.657328362753423,0.198694706541413,0.358292784447601,0.323044888836039,0.153725377564811,0.570564110099973,0.319857713627183,0.0323101090841107,0.0415601937076527,0.0403879023376204,0.302730949670793,0.0319778920738454,0.0319392071193418,0.3539469439039,0.0284712934710093,0.188849752934514,0.039984519438877,0.0407599929123537,0.0308184040382526,0.031901252720551,0.0371665519303753,0.15852831864525,0.0302888012801453,0.128929355319802,0.0372400527068726,0.175605521555582,0.0278955066386349],"arrayminus":[0.0490128603115776,0.030628541881533,0.0321802968978893,0.0427695019333593,0.101450014463855,0.0357821178252387,0.0433628187322119,0.0460691384369728,0.14652564499611,0.0822190366991034,0.0719038203636,0.334112985635703,0.657328362753423,0.198694706541413,0.358292784447601,0.323044888836039,0.153725377564811,0.570564110099973,0.319857713627183,0.0323101090841107,0.0415601937076527,0.0403879023376204,0.302730949670793,0.0319778920738454,0.0319392071193418,0.3539469439039,0.0284712934710093,0.188849752934514,0.039984519438877,0.0407599929123537,0.0308184040382526,0.031901252720551,0.0371665519303753,0.15852831864525,0.0302888012801453,0.128929355319802,0.0372400527068726,0.175605521555582,0.0278955066386349],"type":"data","width":5.73979591836734,"symmetric":false,"color":"rgba(0,0,0,1)"},"frame":null}],"layout":{"margin":{"t":53.1938563719386,"r":39.8505603985056,"b":64.9232046492321,"l":312.660855126609},"font":{"color":"rgba(0,0,0,1)","family":"IBMPlexSans","size":15.2760481527605},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.412296566599975,5.4125917620518],"tickmode":"array","ticktext":["0","1","2","3","4","5"],"tickvals":[-5.55111512312578e-17,1,2,3,4,5],"categoryorder":"array","categoryarray":["0","1","2","3","4","5"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.81901203819012,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"IBMPlexSans","size":11.9551681195517},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(204,204,204,1)","gridwidth":0.265670402656704,"zeroline":false,"anchor":"y","title":{"text":"Odds Ratio + standard_error","font":{"color":"rgba(0,0,0,1)","family":"IBMPlexSans","size":11.9551681195517}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.4,39.6],"tickmode":"array","ticktext":["rd_feature_Five.Point..Or.More","rd_feature_Underpass","light_cond_Other","rd_surface_Other","developmen_Industrial","workzone_Yes","rd_feature_Bridge","traff_cntrl_Other","speed_limit_X50...55..MPH","rd_feature_Y.Intersection","rd_feature_Shared.Use.Paths.Or.Trails","rd_class_US.Route","developmen_Farms..Woods..Pastures","light_cond_Dark...Lighted.Roadway","rd_hill_Yes","rd_class_NC.Route","light_cond_Dark...Roadway.Not.Lighted","speed_limit_X40...45..MPH","rd_class_State.Secondary.Route","crash_loc_Non.Intersection","developmen_Residential","rd_conditio_Dirty.wet","traff_cntrl_No.Control.Present","rural_urban_Urban","locality_Urban...70..Developed.","rd_feature_Driveway..Private","speed_limit_X30...35..MPH","rd_bent_Straight","rd_class_Local.Street","rd_feature_Driveway..Public","traff_cntrl_Stop.And.Go.Signal","light_cond_Daylight","speed_limit_X20...25..MPH","crash_loc_Non.Roadway","rd_class_Public.Vehicular.Area","rd_feature_Traffic.Circle.Roundabout","rd_feature_Non.Intersection.Median.Crossing","traff_cntrl_Flashing.Stop.And.Go.Signal","rd_surface_Gravel"],"tickvals":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39],"categoryorder":"array","categoryarray":["rd_feature_Five.Point..Or.More","rd_feature_Underpass","light_cond_Other","rd_surface_Other","developmen_Industrial","workzone_Yes","rd_feature_Bridge","traff_cntrl_Other","speed_limit_X50...55..MPH","rd_feature_Y.Intersection","rd_feature_Shared.Use.Paths.Or.Trails","rd_class_US.Route","developmen_Farms..Woods..Pastures","light_cond_Dark...Lighted.Roadway","rd_hill_Yes","rd_class_NC.Route","light_cond_Dark...Roadway.Not.Lighted","speed_limit_X40...45..MPH","rd_class_State.Secondary.Route","crash_loc_Non.Intersection","developmen_Residential","rd_conditio_Dirty.wet","traff_cntrl_No.Control.Present","rural_urban_Urban","locality_Urban...70..Developed.","rd_feature_Driveway..Private","speed_limit_X30...35..MPH","rd_bent_Straight","rd_class_Local.Street","rd_feature_Driveway..Public","traff_cntrl_Stop.And.Go.Signal","light_cond_Daylight","speed_limit_X20...25..MPH","crash_loc_Non.Roadway","rd_class_Public.Vehicular.Area","rd_feature_Traffic.Circle.Roundabout","rd_feature_Non.Intersection.Median.Crossing","traff_cntrl_Flashing.Stop.And.Go.Signal","rd_surface_Gravel"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.81901203819012,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"IBMPlexSans","size":11.9551681195517},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(204,204,204,1)","gridwidth":0.265670402656704,"zeroline":false,"anchor":"x","title":{"text":"Variable","font":{"color":"rgba(0,0,0,1)","family":"IBMPlexSans","size":11.9551681195517}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"IBMPlexSans","size":12.2208385222084}},"hovermode":"closest","width":700,"height":750,"barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displayModeBar":false},"source":"A","attrs":{"1318d186dfde":{"x":{},"y":{},"type":"scatter"},"1318d3dd3689a":{"x":{},"y":{},"xmin":{},"xmax":{}}},"cur_data":"1318d186dfde","visdat":{"1318d186dfde":["function (y) ","x"],"1318d3dd3689a":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="what-have-we-learned-from-this" class="section level4">
<h4>What have we learned from this?</h4>
<ul>
<li>We set out to construct a model that could identify environmental factors that increase the risk of accidents labeled <em>serious injuries</em> or <em>killed</em>.</li>
<li>We discovered a large class imbalance between these occurances and the rest. This is of course good for the cyclists of North Carolina but presents a challange to our modelling efforts.</li>
<li>Therefore I tested two <em>rebalancing algorithms</em> that represent two different approaches. The <em>rose algorithm</em> (creates more observations utilising a k-means algorithm) and a <em>downsampling algorithm</em> (reducing the number of observations in the larger class).</li>
<li>The overall predictive power of our models was drastically improved using these methods, but we were unable to obtain an accuracy above 72 %. It’s certainly better than simple guesswork, but not impressive.</li>
<li>I therefore suggest that the contributing features are examined with some caution.</li>
<li>With this in mind we can suffice decision makers with a list of road features that could be improved to gain the biggest effect. Especially improving condition gravel roads and replacing “flashing stop and go signals” with “regular stop and go signals” would produce dramatic effects.</li>
</ul>
</div>
</div>
